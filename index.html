<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=0.8">
        <link rel="icon" type="image/png" sizes="32x32" href="https://telegra.ph/file/c2a4d8d65722553da4c89.jpg">
        <link rel="stylesheet" type="text/css" href="./css/king.css">
    </head>
    <body>
        <div class="login-box">
            <h2>DEPLOY TRASHCORE</h2>
            <form id="deployForm">
                <div class="user-box">
                    <input type="text" id="name" name="username" required="">
                    <label>ENTER YOUR GITHUB USERNAME</label>
                </div>
                <button type="submit">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                    DEPLOY
                </button>
            </form>
        </div>

        <script src="./js/axios.js"></script>
        <script type="text/javascript">
            document.getElementById('deployForm').addEventListener('submit', async function(event) {
                event.preventDefault();

                const gitApi = 'https://api.github.com';
                const owner = 'Tennor-modz';
                const username = document.getElementById('name').value.trim();

                if (username.length === 0 || username === owner) {
                    alert("Please enter your GitHub username. You cannot use the developer's username.");
                    return;
                }

                try {
                    const user = await axios.get(`${gitApi}/users/${username}`);

                    try {
                        await axios.get(`${gitApi}/repos/${username}/Flash-Md-V2`);
                        window.location.replace(`https://dashboard.heroku.com/new?template=https://github.com/${username}/trashcore-system`);
                    } catch (v2Error) {
                        try {
                            await axios.get(`${gitApi}/repos/${username}/Flash-Md`);
                            window.location.replace(`https://dashboard.heroku.com/new?template=https://github.com/${username}/trashcore-system`);
                        } catch (oldError) {
                            alert("It looks like you haven't forked the repository yet.\nClick 'OK' to fork.");
                            window.location.replace(`https://github.com/${owner}/trashcore-system/fork`);
                        }
                    }
                } catch (userError) {
                    alert('Invalid GitHub username. Please ensure the username is correct and try again.');
                }
            });
        </script>
    </body>
</html>
